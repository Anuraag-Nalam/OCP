<!-- when we have copied the starter template from getbootstrap.com at that time only we have included the cdn -->
<!-- REFER THE BOOTSTRAP CARDS AND CAROUSEL W3 SCHOOLS TO UNDERSTAND THE SLIDES OVER HERE -->


<!-- /* The flip card container - set the width and height to whatever you want. We have added the border property to demonstrate that the flip itself goes out of the box on hover (remove perspective if you don't want the 3D effect */
<!DOCTYPE html> -->
<html lang="en">

<head>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto+Condensed:ital,wght@1,700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
   <!-- Bootstrap CSS -->
      <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">-->
  <style>
    .col-md-3 {
      display: inline-block;
      margin-left: -4px;
    }



    .carousel-indicators .active {
      background-color: blue;
    }

    .col-md-3 img {

      width: 230px;
      height: 300px;
    }

    body {
      font-family: 'Dancing Script', cursive;
      font-family: 'Roboto Condensed', sans-serif;
    }


    body .carousel-indicators li {
      background-color: blue;
    }

    body .carousel-indicators {
      bottom: -40px;
      height: 6px;
    }


    body .carousel-control-prev-icon,
    body .carousel-control-next-icon {
      background-color: blue;
    }

    .carousel-control-prev,
    .carousel-control-next {
      top: auto;
      bottom: auto;
      padding-top: 222px;
    }


    .text-block {
      position: absolute;
      bottom: 0px;
      right: 0px;
      height: 20px;
      background-color: green;
      color: white;

    }



    .flip-card {
      background-color: transparent;
      width: 270px;
      height: 350px;
      perspective: 1000px;
    }

    .flip-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
    }

    .flip-card:hover .flip-card-inner {
      transform: rotateY(180deg);
    }

    .flip-card-front,
    .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }

    .flip-card-front {
      background-color: white;
      color: black;
    }

    .flip-card-back {
      background-color: #2980b9;
      color: white;
      transform: rotateY(180deg);
  </style>

  <title>index page</title>
</head>


<body>
  {% load static %}
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="#">ONE CLICK PICK (An E-com Website For You)</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/shop/about">ABOUT US <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/shop/contact">CONTACT US</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/shop/tracker">TRACKER</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/shop/checkout">CHECK OUT</a>
        </li>
        <li class="nav-item" id='clearcart'>
          <a class="nav-link" href="#">CLEAR CART</a>
        </li>
        <li class="nav-item" id='blog'>
          <a class="nav-link" href="/blog">BLOG</a>
        </li>

      </ul>
      <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
      </form>

      <button type="button" class="btn btn-secondary mx-2" id="popcart" data-container="body" data-html='true' data-toggle="popover" data-placement="bottom" data-content="">
        Cart(<span id='Cart'>0</span>)
      </button>
    </div>
  </nav>
  <div class="container">
    {% for product,range,nslides in allprods%}
    <h5 class='my-4'>{{product.0.category}}-RECOMMENDED ITEMS</h5>
    <div class="row">
      <div id="demo{{forloop.counter}}" class='col carousel slide my-3' data-ride='carousel'>
        <ul class="carousel-indicators">
          <li data-target="#demo{{forloop.counter}}" data-slide-to='0' class='active'></li>
          <!-- django templates syntax for he for loop -->
          <!-- here the for loo is looping through the slides as in the range function we have mentioned as nslides is the endpoint -->
          {%for i in range%}
          <li data-target="#demo{{forloop.parentloop.counter}}" data-slide-to='{{i}}'></li>
          {% endfor %}
        </ul>
        <!-- first slide -->
        <div class="container carousel-inner no-padding">
          <div class="carousel-item active">
            <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="flip-card">
                <div class="flip-card-inner">
                  <div class="flip-card-front">
                    <img src='/media/{{product.0.image}}' alt="Avatar" style="width:230px;height:300px;">
                    <div class="container">
                      <div class="text-block">

                        <p>HOVER OVER THE IMAGE TO FLIP BACK</p>
                      </div>
                    </div>
                  </div>
                  <div class="flip-card-back">
                    <div class="container my-5">
                      <h4 id=namepr{{product.0.id}}>{{product.0.product_name}}</h4>
                      <p>{{product.0.desc|slice:"0:50"}}...</p>
                      <h6>Price:<span  id="pricepr{{product.0.id}}">{{product.0.price}}</span></h6>
                      <div class="w3-card-4 white" style="width:100%">

                        <div class="w3-container w3-center">


                          <div class="section">
                            <span id="divpr{{product.0.id}}" class="divpr">
                              <button type="button" id="pr{{product.0.id}}" class="btn btn-danger cart">Add To Cart</button></span>
                            <a href="/shop/products/{{product.0.id}}"><button type="button" id="qv{{product.0.id}}" class="btn btn-warning">QuickView</button></a>

                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- zeroth index is handled above -->
            {%for i in product|slice:"1:"%}
            <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="flip-card">
                <div class="flip-card-inner">
                  <div class="flip-card-front">
                    <img src="/media/{{i.image}}" alt="Avatar" style="width:230px;height:300px;">
                    <div class="text-block">

                      <p>HOVER ON THE IMAGE TO FLIP BACK</p>
                    </div>
                  </div>
                  <div class="flip-card-back">
                    <div class="container my-5">
                      <h4 id=namepr{{i.id}}> {{i.product_name}}</h4>
                      <p>{{i.desc|slice:"0:50"}}...</p>
                      <h6>Price:<span  id="pricepr{{i.id}}">{{i.price}}</span></h6>

                      <div class="w3-card-4 white" style="width:100%">

                        <div class="w3-container w3-center">



                          <div class="section">
                            <span id="divpr{{i.id}}" class="divpr">

                              <button type="button" id="pr{{i.id}}" class="btn btn-danger cart">Add To Cart</button></span>
                            <a href="/shop/products/{{i.id}}"><button type="button" id="qv{{i.id}}" class="btn btn-warning">QuickView</button></a>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% if forloop.counter|add:1|divisibleby:4 and forloop.counter > 0 and not forloop.last %}
          </div>
          <div class="carousel-item">
            {% endif%}

            {% endfor %}





            <!-- carousel-item-active closing div -->
          </div>
          <!-- container carousel-inner no-padding -->
        </div>
        <!-- demo -->

      </div>



      <!-- left and right controls for the carousel items -->

      <!-- <a class="carousel-control-prev" href="#demo{{forloop.counter}}" data-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </a>
    <a class="carousel-control-next" href="#demo{{forloop.counter}}" data-slide="next">
      <span class="carousel-control-next-icon"></span>
    </a> -->
      <a class="carousel-control-prev" href="#demo{{forloop.counter}}" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#demo{{forloop.counter}}" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
    {% endfor %}
    <!-- container -->

  </div>
  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</body>
<script>
  if (localStorage.getItem('cart') == null) {
    //an empty cart is created over here.
    var cart = {};
  } else {
    cart = JSON.parse(localStorage.getItem('cart'));
    document.getElementById('Cart').innerHTML = Object.keys(cart).length;

    updateCart(cart);
  }
  $('.divpr').on('click','button.cart',function() {

    var idstr = this.id.toString();
    console.log(idstr)
    //in the if statement we are not writing any index after cart[idstr] because
    if (cart[idstr] != undefined) {
      //the  quantity is being increased by one and note that cart is a dictionary. it is a key value pair of id and quantity.
      //creating two variables after the names qty and name so as to access the names of the products in the checkout page
      //accessing the quantity using the index 0
      qty=cart[idstr][0] + 1;
      //name will already be present so no need to update name again into the cart.
      //name="My Item"
      //cart[idstr] =[qty,name]
    } else {
      qty=1;
      name=document.getElementById('name'+idstr).innerHTML;
      price=document.getElementById('price'+idstr).innerHTML;
      cart[idstr] =[qty,name,parseInt(price)];
    }
    console.log(cart);
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('Cart').innerHTML = Object.keys(cart).length;
    updateCart(cart);

  });
  $('#popcart').popover();
  //document.getElementById('popcart').setAttribute('data-content', '<h5>Cart</h5>')
  //namepr{{i.id}} is an id which is used for capturing the product name

updatePopover(cart);
  function updatePopover(cart){
    var popstr="";
    popstr="<h5>Cart for your items in my OneClickPick cart</h5><div class='mx-2 my-2'>";
    var i=1;
    for(var item in cart){
      popstr=popstr+"<b>" + i + "</b>. ";
      popstr=popstr+document.getElementById('name'+item).innerHTML.slice(0,20)+"...Qty:"+cart[item][0]+'<br>';
      //item=item+1;

      if(i>4){
        popstr=popstr+'........CLICK ON THE CHECKOUT OPTION IN THE NAVIGATION BAR TO SEE THE ITEMS IN YOUR CART'
        break;
      }i=i+1;
  }
    document.getElementById('popcart').setAttribute('data-content',popstr);
    $('#popcart').popover('show');
}
  $('#clearcart').click(function(){
    cart=JSON.parse(localStorage.getItem('cart'));
    for (var item in cart){
      document.getElementById('div'+item).innerHTML='<button id="'+item+'" class="btn btn-danger cart">Add To Cart</button>'
    }
    localStorage.clear();
    cart={}
    updateCart(cart);
  })
  function updateCart(cart) {
    console.log(cart)
    for (var item in cart) {

       document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "' class='btn btn-success minus'> <i class= 'fa fa-shopping-cart'></i> - </button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item +
         "' class='btn btn-success plus'> <i class= 'fa fa-shopping-cart'></i> +  </button>";
      //document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "''>" + cart[item] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";
    }
    console.log(cart)
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('Cart').innerHTML = Object.keys(cart).length;
    //so as to add all the items in the summary of the cart in the popover (bottom), we are calling this function
    updatePopover(cart);
  }
  $('.divpr').on("click", "button.minus", function() {
    a = this.id.slice(7, );
    cart['pr' + a][0] = cart['pr' + a][0] - 1;
    cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
    document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    if(cart['pr'+a][0]==0){
      document.getElementById('divpr'+a).innerHTML='<button id="pr'+a+'" class= "btn btn-danger cart">Add To Cart</button>'
      delete cart['pr'+a];
    }

    else{
      document.getElementById('valpr'+a).innerHTML=cart['pr'+a][0];
    }
    updateCart(cart);
  });
  $('.divpr').on("click", "button.plus", function() {
    a = this.id.slice(6, );
    cart['pr' + a][0] = cart['pr' + a][0] + 1;
    document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    updateCart(cart);
  });




</script>

</html>
<!-- we have created our own templates directory in the blog directory and have created a new html file called as
index.html where we are going to include our bootstrap.This belongs to the shop app -->
